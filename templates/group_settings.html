<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã - {{ group.name }}</title>
    <style>
        .settings-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid #007bff;
            margin-bottom: 15px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ */
        .member-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        .member-info {
            flex: 1;
        }
        .role-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: normal;
        }
        .role-admin {
            background: #dc3545;
            color: white;
        }
        .role-moderator {
            background: #17a2b8;
            color: white;
        }
        .role-member {
            background: #6c757d;
            color: white;
        }
        .role-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        .member-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .transfer-admin-btn {
            padding: 8px 15px;
            background: #ffc107;
            color: #856404;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .save-role-btn {
            padding: 8px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .remove-member-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .current-creator {
            border-color: #ffc107;
            background: #fffdf6;
        }
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .pagination-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .pagination-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        .pagination-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        /* –°—á–µ—Ç—á–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
        .members-counter {
            background: #e9f7fe;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã: {{ group.name }}</h1>

        <div style="margin-bottom: 20px;">
            <a href="/group/{{ group.id }}" style="margin-right: 10px;">‚Üê –ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–µ</a>
        </div>

        <form method="POST" action="/group/{{ group.id }}/settings" enctype="multipart/form-data" id="groupSettingsForm">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="settings-section">
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã *</strong></label>
                    <input type="text" name="name" value="{{ group.name }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                           required>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong></label>
                    <textarea name="description"
                              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; height: 100px;">{{ group.description or '' }}</textarea>
                </div>
            </div>

            <!-- –ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã -->
            <div class="settings-section">
                <h3>–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã</h3>

                {% if group.avatar and group.avatar != 'default_group.png' %}
                <div style="margin-bottom: 15px;">
                    <strong>–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä:</strong><br>
                    <img src="{{ url_for('static', filename='uploads/groups/' + group.avatar) }}"
                         class="avatar-preview"
                         onerror="this.src='https://via.placeholder.com/120?text=Group'">
                </div>
                {% endif %}

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–ù–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä:</strong></label>
                    <input type="file" name="avatar" accept="image/*" style="width: 100%; padding: 8px;">
                    <p style="margin-top: 5px; color: #666; font-size: 12px;">
                        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 400x400px. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF
                    </p>
                </div>

                {% if group.avatar and group.avatar != 'default_group.png' %}
                <div style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" name="remove_avatar">
                        –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä
                    </label>
                </div>
                {% endif %}
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ -->
            <div class="settings-section">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h3>

                <div style="margin-bottom: 20px; display: flex; align-items: center;">
                    <strong style="margin-right: 20px;">–¢–∏–ø –≥—Ä—É–ø–ø—ã:</strong>

                    <div style="display: flex; align-items: center; margin-right: 30px;">
                        <label style="margin-right: 10px; cursor: pointer;">
                            <input type="radio" name="is_public" value="1"
                                   {% if group.is_public %}checked{% endif %}>
                            –ü—É–±–ª–∏—á–Ω–∞—è
                        </label>
                        <div style="color: #666; font-size: 14px;">
                            –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                        </div>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <label style="margin-right: 10px; cursor: pointer;">
                            <input type="radio" name="is_public" value="0"
                                   {% if not group.is_public %}checked{% endif %}>
                            –ü—Ä–∏–≤–∞—Ç–Ω–∞—è
                        </label>
                        <div style="color: #666; font-size: 14px;">
                            –¢–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–µ
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                    <p style="margin: 0; color: #666;">
                        <strong>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞:</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã —Ä–µ—à–∞—é—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏—Ö –∏–ª–∏ –Ω–µ—Ç.
                    </p>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π -->
            <div class="settings-section">
                <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –≥—Ä—É–ø–ø–µ</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 10px;"><strong>–ö—Ç–æ –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å:</strong></label>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="admins"
                                   {% if group.post_permissions == 'admins' %}checked{% endif %}>
                            <strong>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –ø–æ—Å—Ç—ã
                            </div>
                        </label>
                    </div>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="moderators"
                                   {% if group.post_permissions == 'moderators' %}checked{% endif %}>
                            <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ú–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç–∞–º–∏ –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                            </div>
                        </label>
                    </div>

                    <div>
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="all"
                                   {% if not group.post_permissions or group.post_permissions == 'all' %}checked{% endif %}>
                            <strong>–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø–æ—Å—Ç—ã
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø) -->
            {% if not group.is_public %}
            <div class="settings-section" id="request-settings-section">
                <h3>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 10px;"><strong>–ö—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å/–æ—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞—è–≤–∫–∏:</strong></label>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="request_permissions" value="admins"
                                {% if group.request_permissions == 'admins' %}checked{% endif %}>
                            <strong>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
                            </div>
                        </label>
                    </div>

                    <div>
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="request_permissions" value="moderators"
                                {% if not group.request_permissions or group.request_permissions == 'moderators' %}checked{% endif %}>
                            <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                    –ò –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã, –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ (–í–°–ï–ì–î–ê –û–¢–ö–†–´–¢–ê) -->
            <div class="settings-section" id="members-management-section">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>

                <div class="members-counter">
                    –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {{ members|length }}
                </div>

                {% if members %}
                    <div id="members-list">
                        <!-- JavaScript –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ -->
                    </div>

                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    <div id="pagination-controls" class="pagination">
                        <!-- JavaScript —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                    </div>

                    <div id="pagination-info" class="pagination-info">
                        <!-- JavaScript –ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <p>–í –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                    </div>
                {% endif %}
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
            <div style="text-align: right; margin-top: 30px;">
                <button type="submit"
                        style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </form>
    </div>

    <script>
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—è–≤–æ–∫
        function toggleRequestSettings() {
            const isPublic = document.querySelector('input[name="is_public"][value="1"]').checked;
            const requestSettings = document.getElementById('request-settings-section');

            if (requestSettings) {
                if (isPublic) {
                    requestSettings.style.display = 'none';
                } else {
                    requestSettings.style.display = 'block';
                }
            }
        }

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—è–≤–æ–∫
            toggleRequestSettings();

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ —Ç–∏–ø–∞ –≥—Ä—É–ø–ø—ã
            document.querySelectorAll('input[name="is_public"]').forEach(radio => {
                radio.addEventListener('change', toggleRequestSettings);
            });
        });

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const membersPerPage = 20; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        let currentPage = 1;
        const allMembers = {{ members|tojson }};

        function displayMembersPage(page) {
            const startIndex = (page - 1) * membersPerPage;
            const endIndex = startIndex + membersPerPage;
            const pageMembers = allMembers.slice(startIndex, endIndex);

            const membersList = document.getElementById('members-list');
            membersList.innerHTML = '';

            pageMembers.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = `member-card ${member.id === {{ group.creator_id }} ? 'current-creator' : ''}`;

                memberCard.innerHTML = `
                    <img src="${member.avatar.startsWith('http') ? member.avatar : '/static/uploads/avatars/' + member.avatar}"
                         class="member-avatar"
                         onerror="this.src='https://via.placeholder.com/50?text=Avatar'">

                    <div class="member-info">
                        <h4 style="margin: 0 0 5px 0;">
                            ${member.full_name || member.username}
                            <span class="role-badge role-${member.role}">
                                ${member.id === {{ group.creator_id }} ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' :
                                  member.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' :
                                  member.role === 'moderator' ? '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}
                            </span>
                        </h4>
                        <p style="margin: 0; color: #666;">@${member.username}</p>
                    </div>

                    <div class="member-actions">
                        ${member.id === {{ group.creator_id }} ?
                            `<span style="color: #856404; font-size: 14px;">–°–æ–∑–¥–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø—ã</span>` :
                            `
                            ${member.role !== 'admin' ?
                                `<button type="button"
                                        class="transfer-admin-btn"
                                        onclick="transferAdmin(${member.id}, '${member.username}')"
                                        title="–ü–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                                    üëë –°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º
                                </button>` : ''}

                            <select class="role-select" id="role-select-${member.id}" data-user-id="${member.id}">
                                <option value="member" ${member.role === 'member' ? 'selected' : ''}>–£—á–∞—Å—Ç–Ω–∏–∫</option>
                                <option value="moderator" ${member.role === 'moderator' ? 'selected' : ''}>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                                ${member.role === 'admin' ? '<option value="admin" selected>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>' : ''}
                            </select>

                            <button type="button"
                                    class="save-role-btn"
                                    onclick="saveRole(${member.id})">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>

                            <button type="button"
                                    class="remove-member-btn"
                                    onclick="removeMember(${member.id}, '${member.username}')">
                                –ò—Å–∫–ª—é—á–∏—Ç—å
                            </button>
                            `
                        }
                    </div>
                `;

                membersList.appendChild(memberCard);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            document.getElementById('pagination-info').innerHTML =
                `–ü–æ–∫–∞–∑–∞–Ω–æ ${startIndex + 1}-${Math.min(endIndex, allMembers.length)} –∏–∑ ${allMembers.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.pagination-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.page) === page) {
                    btn.classList.add('active');
                }
            });
        }

        function setupPagination() {
            if (allMembers.length === 0) return;

            const totalPages = Math.ceil(allMembers.length / membersPerPage);
            const paginationControls = document.getElementById('pagination-controls');

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–Ω–æ–ø–∫–∏
            paginationControls.innerHTML = '';

            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '‚Üê';
                prevBtn.className = 'pagination-btn';
                prevBtn.dataset.page = currentPage - 1;
                prevBtn.onclick = () => {
                    currentPage--;
                    displayMembersPage(currentPage);
                };
                paginationControls.appendChild(prevBtn);
            }

            // –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = 'pagination-btn';
                    pageBtn.dataset.page = i;
                    if (i === currentPage) pageBtn.classList.add('active');

                    pageBtn.onclick = () => {
                        currentPage = i;
                        displayMembersPage(currentPage);
                    };

                    paginationControls.appendChild(pageBtn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    // –ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    paginationControls.appendChild(ellipsis);
                }
            }

            // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '‚Üí';
                nextBtn.className = 'pagination-btn';
                nextBtn.dataset.page = currentPage + 1;
                nextBtn.onclick = () => {
                    currentPage++;
                    displayMembersPage(currentPage);
                };
                paginationControls.appendChild(nextBtn);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            if (allMembers.length > 0) {
                setupPagination();
                displayMembersPage(1);
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
        function saveRole(userId) {
            const roleSelect = document.getElementById(`role-select-${userId}`);
            const newRole = roleSelect.value;

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ "${getRoleName(newRole)}"?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/change_role/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ role: newRole })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–†–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        function getRoleName(role) {
            switch(role) {
                case 'admin': return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                case 'moderator': return '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä';
                case 'member': return '–£—á–∞—Å—Ç–Ω–∏–∫';
                default: return role;
            }
        }

        function transferAdmin(userId, username) {
            if (!confirm(`–í–ù–ò–ú–ê–ù–ò–ï: –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}.\n\n–ü–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ –≤—ã —Å—Ç–∞–Ω–µ—Ç–µ –æ–±—ã—á–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∏ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≥—Ä—É–ø–ø—ã.\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/transfer_admin/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω—ã!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        function removeMember(userId, username) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username} –∏–∑ –≥—Ä—É–ø–ø—ã?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/remove_member/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('groupSettingsForm').addEventListener('submit', function(event) {
            // –ü–æ–∑–≤–æ–ª—è–µ–º —Ñ–æ—Ä–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
            // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥—Ä—É–ø–ø—ã
        });
    </script>
</body>
=======
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã - {{ group.name }}</title>
    <style>
        .settings-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid #007bff;
            margin-bottom: 15px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ */
        .member-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        .member-info {
            flex: 1;
        }
        .role-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: normal;
        }
        .role-admin {
            background: #dc3545;
            color: white;
        }
        .role-moderator {
            background: #17a2b8;
            color: white;
        }
        .role-member {
            background: #6c757d;
            color: white;
        }
        .role-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        .member-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .transfer-admin-btn {
            padding: 8px 15px;
            background: #ffc107;
            color: #856404;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .save-role-btn {
            padding: 8px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .remove-member-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .current-creator {
            border-color: #ffc107;
            background: #fffdf6;
        }
        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        .pagination-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .pagination-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        .pagination-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        /* –°—á–µ—Ç—á–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
        .members-counter {
            background: #e9f7fe;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã: {{ group.name }}</h1>

        <div style="margin-bottom: 20px;">
            <a href="/group/{{ group.id }}" style="margin-right: 10px;">‚Üê –ù–∞–∑–∞–¥ –∫ –≥—Ä—É–ø–ø–µ</a>
        </div>

        <form method="POST" action="/group/{{ group.id }}/settings" enctype="multipart/form-data" id="groupSettingsForm">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="settings-section">
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã *</strong></label>
                    <input type="text" name="name" value="{{ group.name }}"
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                           required>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong></label>
                    <textarea name="description"
                              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; height: 100px;">{{ group.description or '' }}</textarea>
                </div>
            </div>

            <!-- –ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã -->
            <div class="settings-section">
                <h3>–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã</h3>

                {% if group.avatar and group.avatar != 'default_group.png' %}
                <div style="margin-bottom: 15px;">
                    <strong>–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä:</strong><br>
                    <img src="{{ url_for('static', filename='uploads/groups/' + group.avatar) }}"
                         class="avatar-preview"
                         onerror="this.src='https://via.placeholder.com/120?text=Group'">
                </div>
                {% endif %}

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;"><strong>–ù–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä:</strong></label>
                    <input type="file" name="avatar" accept="image/*" style="width: 100%; padding: 8px;">
                    <p style="margin-top: 5px; color: #666; font-size: 12px;">
                        –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 400x400px. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF
                    </p>
                </div>

                {% if group.avatar and group.avatar != 'default_group.png' %}
                <div style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" name="remove_avatar">
                        –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä
                    </label>
                </div>
                {% endif %}
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ -->
            <div class="settings-section">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h3>

                <div style="margin-bottom: 20px; display: flex; align-items: center;">
                    <strong style="margin-right: 20px;">–¢–∏–ø –≥—Ä—É–ø–ø—ã:</strong>

                    <div style="display: flex; align-items: center; margin-right: 30px;">
                        <label style="margin-right: 10px; cursor: pointer;">
                            <input type="radio" name="is_public" value="1"
                                   {% if group.is_public %}checked{% endif %}>
                            –ü—É–±–ª–∏—á–Ω–∞—è
                        </label>
                        <div style="color: #666; font-size: 14px;">
                            –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                        </div>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <label style="margin-right: 10px; cursor: pointer;">
                            <input type="radio" name="is_public" value="0"
                                   {% if not group.is_public %}checked{% endif %}>
                            –ü—Ä–∏–≤–∞—Ç–Ω–∞—è
                        </label>
                        <div style="color: #666; font-size: 14px;">
                            –¢–æ–ª—å–∫–æ –ø–æ –∑–∞—è–≤–∫–µ
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                    <p style="margin: 0; color: #666;">
                        <strong>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞:</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫—É, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã —Ä–µ—à–∞—é—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏—Ö –∏–ª–∏ –Ω–µ—Ç.
                    </p>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π -->
            <div class="settings-section">
                <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –≥—Ä—É–ø–ø–µ</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 10px;"><strong>–ö—Ç–æ –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å:</strong></label>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="admins"
                                   {% if group.post_permissions == 'admins' %}checked{% endif %}>
                            <strong>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –ø–æ—Å—Ç—ã
                            </div>
                        </label>
                    </div>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="moderators"
                                   {% if group.post_permissions == 'moderators' %}checked{% endif %}>
                            <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ú–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç–∞–º–∏ –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                            </div>
                        </label>
                    </div>

                    <div>
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="post_permissions" value="all"
                                   {% if not group.post_permissions or group.post_permissions == 'all' %}checked{% endif %}>
                            <strong>–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø–æ—Å—Ç—ã
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø) -->
            {% if not group.is_public %}
            <div class="settings-section" id="request-settings-section">
                <h3>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</h3>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 10px;"><strong>–ö—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å/–æ—Ç–∫–ª–æ–Ω—è—Ç—å –∑–∞—è–≤–∫–∏:</strong></label>

                    <div style="margin-bottom: 10px;">
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="request_permissions" value="admins"
                                {% if group.request_permissions == 'admins' %}checked{% endif %}>
                            <strong>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≥—Ä—É–ø–ø—ã –º–æ–≥—É—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
                            </div>
                        </label>
                    </div>

                    <div>
                        <label style="display: block; padding: 10px; border-radius: 5px; background: #f8f9fa; cursor: pointer;">
                            <input type="radio" name="request_permissions" value="moderators"
                                {% if not group.request_permissions or group.request_permissions == 'moderators' %}checked{% endif %}>
                            <strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</strong>
                            <div style="margin-left: 25px; color: #666; font-size: 14px;">
                                    –ò –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã, –∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ (–í–°–ï–ì–î–ê –û–¢–ö–†–´–¢–ê) -->
            <div class="settings-section" id="members-management-section">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>

                <div class="members-counter">
                    –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {{ members|length }}
                </div>

                {% if members %}
                    <div id="members-list">
                        <!-- JavaScript –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ -->
                    </div>

                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    <div id="pagination-controls" class="pagination">
                        <!-- JavaScript —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                    </div>

                    <div id="pagination-info" class="pagination-info">
                        <!-- JavaScript –ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <p>–í –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                    </div>
                {% endif %}
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
            <div style="text-align: right; margin-top: 30px;">
                <button type="submit"
                        style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </form>
    </div>

    <script>
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—è–≤–æ–∫
        function toggleRequestSettings() {
            const isPublic = document.querySelector('input[name="is_public"][value="1"]').checked;
            const requestSettings = document.getElementById('request-settings-section');

            if (requestSettings) {
                if (isPublic) {
                    requestSettings.style.display = 'none';
                } else {
                    requestSettings.style.display = 'block';
                }
            }
        }

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞—è–≤–æ–∫
            toggleRequestSettings();

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ —Ç–∏–ø–∞ –≥—Ä—É–ø–ø—ã
            document.querySelectorAll('input[name="is_public"]').forEach(radio => {
                radio.addEventListener('change', toggleRequestSettings);
            });
        });

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const membersPerPage = 20; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        let currentPage = 1;
        const allMembers = {{ members|tojson }};

        function displayMembersPage(page) {
            const startIndex = (page - 1) * membersPerPage;
            const endIndex = startIndex + membersPerPage;
            const pageMembers = allMembers.slice(startIndex, endIndex);

            const membersList = document.getElementById('members-list');
            membersList.innerHTML = '';

            pageMembers.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = `member-card ${member.id === {{ group.creator_id }} ? 'current-creator' : ''}`;

                memberCard.innerHTML = `
                    <img src="${member.avatar.startsWith('http') ? member.avatar : '/static/uploads/avatars/' + member.avatar}"
                         class="member-avatar"
                         onerror="this.src='https://via.placeholder.com/50?text=Avatar'">

                    <div class="member-info">
                        <h4 style="margin: 0 0 5px 0;">
                            ${member.full_name || member.username}
                            <span class="role-badge role-${member.role}">
                                ${member.id === {{ group.creator_id }} ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' :
                                  member.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' :
                                  member.role === 'moderator' ? '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}
                            </span>
                        </h4>
                        <p style="margin: 0; color: #666;">@${member.username}</p>
                    </div>

                    <div class="member-actions">
                        ${member.id === {{ group.creator_id }} ?
                            `<span style="color: #856404; font-size: 14px;">–°–æ–∑–¥–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø—ã</span>` :
                            `
                            ${member.role !== 'admin' ?
                                `<button type="button"
                                        class="transfer-admin-btn"
                                        onclick="transferAdmin(${member.id}, '${member.username}')"
                                        title="–ü–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                                    üëë –°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º
                                </button>` : ''}

                            <select class="role-select" id="role-select-${member.id}" data-user-id="${member.id}">
                                <option value="member" ${member.role === 'member' ? 'selected' : ''}>–£—á–∞—Å—Ç–Ω–∏–∫</option>
                                <option value="moderator" ${member.role === 'moderator' ? 'selected' : ''}>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                                ${member.role === 'admin' ? '<option value="admin" selected>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>' : ''}
                            </select>

                            <button type="button"
                                    class="save-role-btn"
                                    onclick="saveRole(${member.id})">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>

                            <button type="button"
                                    class="remove-member-btn"
                                    onclick="removeMember(${member.id}, '${member.username}')">
                                –ò—Å–∫–ª—é—á–∏—Ç—å
                            </button>
                            `
                        }
                    </div>
                `;

                membersList.appendChild(memberCard);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            document.getElementById('pagination-info').innerHTML =
                `–ü–æ–∫–∞–∑–∞–Ω–æ ${startIndex + 1}-${Math.min(endIndex, allMembers.length)} –∏–∑ ${allMembers.length} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.pagination-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.page) === page) {
                    btn.classList.add('active');
                }
            });
        }

        function setupPagination() {
            if (allMembers.length === 0) return;

            const totalPages = Math.ceil(allMembers.length / membersPerPage);
            const paginationControls = document.getElementById('pagination-controls');

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–Ω–æ–ø–∫–∏
            paginationControls.innerHTML = '';

            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '‚Üê';
                prevBtn.className = 'pagination-btn';
                prevBtn.dataset.page = currentPage - 1;
                prevBtn.onclick = () => {
                    currentPage--;
                    displayMembersPage(currentPage);
                };
                paginationControls.appendChild(prevBtn);
            }

            // –ù—É–º–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = 'pagination-btn';
                    pageBtn.dataset.page = i;
                    if (i === currentPage) pageBtn.classList.add('active');

                    pageBtn.onclick = () => {
                        currentPage = i;
                        displayMembersPage(currentPage);
                    };

                    paginationControls.appendChild(pageBtn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    // –ú–Ω–æ–≥–æ—Ç–æ—á–∏–µ –¥–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    paginationControls.appendChild(ellipsis);
                }
            }

            // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '‚Üí';
                nextBtn.className = 'pagination-btn';
                nextBtn.dataset.page = currentPage + 1;
                nextBtn.onclick = () => {
                    currentPage++;
                    displayMembersPage(currentPage);
                };
                paginationControls.appendChild(nextBtn);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            if (allMembers.length > 0) {
                setupPagination();
                displayMembersPage(1);
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
        function saveRole(userId) {
            const roleSelect = document.getElementById(`role-select-${userId}`);
            const newRole = roleSelect.value;

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ "${getRoleName(newRole)}"?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/change_role/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ role: newRole })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–†–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        function getRoleName(role) {
            switch(role) {
                case 'admin': return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                case 'moderator': return '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä';
                case 'member': return '–£—á–∞—Å—Ç–Ω–∏–∫';
                default: return role;
            }
        }

        function transferAdmin(userId, username) {
            if (!confirm(`–í–ù–ò–ú–ê–ù–ò–ï: –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}.\n\n–ü–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ –≤—ã —Å—Ç–∞–Ω–µ—Ç–µ –æ–±—ã—á–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∏ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≥—Ä—É–ø–ø—ã.\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/transfer_admin/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω—ã!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        function removeMember(userId, username) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username} –∏–∑ –≥—Ä—É–ø–ø—ã?`)) {
                return;
            }

            fetch(`/group/{{ group.id }}/remove_member/${userId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã!');
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
            });
        }

        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        document.getElementById('groupSettingsForm').addEventListener('submit', function(event) {
            // –ü–æ–∑–≤–æ–ª—è–µ–º —Ñ–æ—Ä–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
            // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥—Ä—É–ø–ø—ã
        });
    </script>
</body>
>>>>>>> c84eaf8ee89e5e7caf8081dcf88b4abda2c60b54
</html>