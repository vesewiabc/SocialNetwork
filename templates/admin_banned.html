{% extends "admin_base.html" %}

{% block title %}Забаненные пользователи{% endblock %}
{% block header %}Забаненные пользователи{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h5>Список забаненных пользователей</h5>
        </div>
        <div class="card-body">
            {% if users %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Никнейм</th>
                            <th>Имя</th>
                            <th>Роль</th>
                            <th>Посты</th>
                            <th>Дата регистрации</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td><strong>{{ user.username }}</strong></td>
                            <td>{{ user.full_name or '-' }}</td>
                            <td>
                                <span class="badge bg-{{ 'danger' if user.role == 'admin' else 'warning' if user.role == 'techadmin' else 'secondary' }}">
                                    {{ 'Админ' if user.role == 'admin' else 'Тех-админ' if user.role == 'techadmin' else 'Пользователь' }}
                                </span>
                            </td>
                            <td>{{ user.posts_count or 0 }}</td>
                            <td>{{ user.created_at|format_date }}</td>
                            <td>
                                <button class="btn btn-success btn-sm unban-user" 
                                        data-user-id="{{ user.id }}" 
                                        data-username="{{ user.username }}">
                                    <i class="bi bi-check-circle"></i> Разбанить
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info">
                Нет забаненных пользователей.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Разбан пользователя
    $('.unban-user').click(function() {
        const userId = $(this).data('user-id');
        const username = $(this).data('username');
        
        if (confirm(`Разбанить пользователя ${username}?`)) {
            $.ajax({
                url: `/admin/unban_user/${userId}`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({}),
                success: function(response) {
                    if (response.success) {
                        alert(response.message);
                        location.reload();
                    } else {
                        alert('Ошибка: ' + response.error);
                    }
                },
                error: function() {
                    alert('Ошибка сервера');
                }
            });
        }
    });
});
</script>
{% endblock %}